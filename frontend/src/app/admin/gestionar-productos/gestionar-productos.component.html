<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">Stockify - Productos</span>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" routerLink="/admin/dashboard">
            <i class="bi bi-house-door-fill me-1"></i> Inicio
          </a>
        </li>
        <li class="nav-item">
          <button class="btn btn-link nav-link" (click)="abrirModalAgregar()" type="button">
            <i class="bi bi-box-seam-fill me-1"></i> Agregar Producto
          </button>
        </li>
      </ul>
    </div>
    <div class="d-flex align-items-center">
      <span class="text-white me-3">
        <i class="bi bi-person-circle me-1"></i>
        Administrador {{ nombreUsuarioLogueado }}
      </span>
      <button class="btn btn-outline-light btn-sm" (click)="cerrarSesion()">
        <i class="bi bi-box-arrow-right me-1"></i>
        Cerrar sesión
      </button>
    </div>
  </div>
</nav>

<!-- Contenido -->
<div class="container py-5">
  <h2 class="mb-4 text-center">Lista de Productos</h2>

  <!-- Buscador -->
  <div class="mb-4">
    <input
      type="text"
      class="form-control"
      placeholder="Buscar por nombre, código o detalle..."
      [(ngModel)]="filtro"
    />
  </div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table
      class="table table-bordered text-center align-middle"
      *ngIf="filtrarProductos().length > 0; else sinProductos"
    >
      <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Código</th>
        <th>Detalle</th>
        <th>Precio</th>
        <th>Stock</th>
        <th>Categoría</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let prod of obtenerProductosPaginados(); let i = index">
        <td>{{ prod.id }}</td>
        <td>{{ prod.nombre }}</td>
        <td>{{ prod.codigoBarra }}</td>
        <td>{{ prod.detalle }}</td>
        <td>${{ prod.precio | number: '1.2-2' }}</td>
        <td>{{ prod.cantidadStock }}</td>
        <td>{{ prod.categoriaNombre || 'Sin Categoría' }}</td>
        <td>
            <span class="badge" [ngClass]="prod.activo ? 'bg-success' : 'bg-danger'">
              {{ prod.activo ? 'Activo' : 'Inactivo' }}
            </span>
        </td>
        <td>
          <button class="btn btn-sm btn-warning me-2" (click)="editarProducto(prod)">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button
            class="btn btn-sm"
            [ngClass]="prod.activo ? 'btn-danger' : 'btn-success'"
            (click)="toggleEstadoProducto(prod)"
          >
            <i [ngClass]="prod.activo ? 'bi bi-slash-circle' : 'bi bi-check-circle-fill'"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Sin productos -->
  <ng-template #sinProductos>
    <p class="text-center text-muted">No hay productos para mostrar.</p>
  </ng-template>

  <!-- Paginación -->
  <nav *ngIf="totalPaginas() > 1">
    <ul class="pagination justify-content-center mt-4">
      <li class="page-item" [class.disabled]="paginaActual === 1">
        <button class="page-link" (click)="paginaActual = paginaActual - 1" [disabled]="paginaActual === 1">
          Anterior
        </button>
      </li>

      <li class="page-item"
          *ngFor="let page of [].constructor(totalPaginas()); let i = index"
          [class.active]="paginaActual === i + 1">
        <button class="page-link" (click)="paginaActual = i + 1">{{ i + 1 }}</button>
      </li>

      <li class="page-item" [class.disabled]="paginaActual === totalPaginas()">
        <button class="page-link" (click)="paginaActual = paginaActual + 1" [disabled]="paginaActual === totalPaginas()">
          Siguiente
        </button>
      </li>
    </ul>
  </nav>
</div>

<!-- Modal -->
<div class="modal fade" id="productoModal" tabindex="-1" aria-labelledby="productoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productoModalLabel">
          {{ esEditar ? 'Editar Producto' : 'Agregar Producto' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="guardarProducto()">
          <!-- Aquí los campos del formulario -->
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" [(ngModel)]="productoSeleccionado.nombre" name="nombre" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Código de Barra</label>
            <input type="text" class="form-control" [(ngModel)]="productoSeleccionado.codigoBarra" name="codigoBarra" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Detalle</label>
            <textarea class="form-control" [(ngModel)]="productoSeleccionado.detalle" name="detalle"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Precio</label>
            <input type="number" class="form-control" [(ngModel)]="productoSeleccionado.precio" name="precio" min="0" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Stock</label>
            <input type="number" class="form-control" [(ngModel)]="productoSeleccionado.cantidadStock" name="cantidadStock" min="0" required>
          </div>

          <!-- Puedes agregar otros campos como categoría, imagen, etc. -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-primary" (click)="guardarProducto()">Guardar</button>
      </div>
    </div>
  </div>
</div>
